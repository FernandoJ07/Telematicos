<VirtualHost *:443>
    ServerName localhost
    ServerAdmin webmaster@localhost
    
    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/apache2/ssl/server.crt
    SSLCertificateKeyFile /etc/apache2/ssl/server.key
    
    # Security Headers
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    
    # WSGI Configuration
    WSGIDaemonProcess webapp user=www-data group=www-data threads=5 python-home=/usr/local python-path=/var/www/webapp
    WSGIScriptAlias / /var/www/webapp/webapp.wsgi
    
    <Directory /var/www/webapp>
        WSGIProcessGroup webapp
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    </Directory>
    
    # Static files
    Alias /static /var/www/webapp/web/static
    <Directory /var/www/webapp/web/static>
        Require all granted
    </Directory>
    
    ErrorLog ${APACHE_LOG_DIR}/webapp_ssl_error.log
    CustomLog ${APACHE_LOG_DIR}/webapp_ssl_access.log combined
    
    # SSL Protocol and Cipher Configuration
    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite HIGH:!aNULL:!MD5
    SSLHonorCipherOrder on
    
    # Server Status para m√©tricas (accesible desde contenedores internos)
    <Location /server-status>
        SetHandler server-status
        Require local
        Require ip 172.16.0.0/12
        Require ip 172.20.0.0/16
    </Location>
</VirtualHost>
