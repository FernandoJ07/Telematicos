# Configuración NAT para el firewall
# Este archivo debe agregarse al inicio de /etc/ufw/before.rules

*nat
:PREROUTING ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]

#Redirigir FTP
# Redirecciona el puerto 21 (FTP control) hacia el servidor maestro
-A PREROUTING -p tcp --dport 21 -j DNAT --to-destination 192.168.50.10:21
# Redirecciona el rango de puertos pasivos FTP hacia el servidor maestro
-A PREROUTING -p tcp --dport 40000:40010 -j DNAT --to-destination 192.168.50.10

#Redirigir DNS
# Redirecciona consultas DNS UDP hacia el servidor esclavo
-A PREROUTING -p udp --dport 53 -j DNAT --to-destination 192.168.50.11:53
# Redirecciona consultas DNS TCP hacia el servidor esclavo
-A PREROUTING -p tcp --dport 53 -j DNAT --to-destination 192.168.50.11:53

#Redirigir HTTP del cliente al esclavo
# Redirecciona tráfico HTTP hacia el servidor maestro
-A PREROUTING -p tcp --dport 80 -j DNAT --to-destination 192.168.50.10:80
# Redirecciona tráfico HTTPS hacia el servidor maestro
-A PREROUTING -p tcp --dport 443 -j DNAT --to-destination 192.168.50.10:443

#Hacer SNAT/MASQUERADE para que el maestro responda al cliente a través del firewall
# MASQUERADE específico para la comunicación con el servidor esclavo DNS
-A POSTROUTING -s 192.168.50.0/24 -d 192.168.50.11 -j MASQUERADE
# MASQUERADE general para todo el tráfico saliente
-A POSTROUTING -j MASQUERADE
COMMIT